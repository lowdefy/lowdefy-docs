{
  "config": {
    "git": {
      "productionBranch": "master",
      "stagingBranches": ["dev"]
    },
  
    "defaults": {
      "countryDialCode": "+27"
    },
  
    "theme": {
      "cssVariables": {
        "@primary-color": "#189077",
        "@font-size-sm": "10px"
      },
      "pages": {
        "app": { 
          "pageTitle" : "My App"
        },
        "signUp": {
          "title": "Sign up 2"
        },
        "postSignUp": {
          "title": "Sign up done 2"
        },
        "signIn": {
          "title": "Sign in 2"
        },
        "resetPassword": {
          "title": "Reset your password 2"
        },
        "changePassword": {
          "title": "Change your password 2"
        },
        "requireNewPassword": {
          "title": "Change your password 2"
        },
        "updateProfile": {
          "title": "Update your profile 2"
        },
        "verifyPhoneNumber": {
          "title": "Verify phone number 2"
        }
      },
      "images": {
        "logo": "/images/logo.png",
        "smallLogo": "/images/favicon.png",
        "favicon": "/images/favicon.png"
      }
    },
  
    "auth": {
      "passwords": {
        "minLength": 8,
        "require": ["numbers"]
      },
      "mfa": {
        "enforce": "optional",
        "method": "totp"
      },
      "verify": ["email", "phone_number"],
      "createUsers": "self_sign_up",
      "advanced": false
    },
  
    "users": {
      "collection": "my_users",
  
      "email": {
        "label": "Email changes",
        "placeholder": "Email it",
        "rules": [
          {
            "status": "warning",
            "message": "Use your company email",
            "test": "regex",
            "rule": ".*@mrmapp\\.com$"
          }
        ]
      },
      "firstName": {
        "label": "Your FirstName",
        "placeholder": "Test"
      },
      "lastName": {
        "label": "Your lastName",
        "placeholder": "Test ls"
      },
      "phoneNumber": {
        "label": "Your phoneNumber",
        "placeholder": "Test pn"
      },
  
      "adminAttributes": [
        {
          "type": "text_input",
          "name": "branch",
          "properties": {
            "label": "Branch"
          }
        }
      ],
  
      "userAttributes": [
       {
          "type": "select_input",
          "name": "Region",
          "properties": {
            "label": "Region",
            "required": true,
            "options": [
              "CPT",
              "JHB",
              "PTA"
            ]
          }
        }
      ]
    }
  
  },

  "connections": [
    {
      "id": "foo_sales",
      "type": "mongodb_collection",
      "properties": {
        "databaseUri": { "_secret": "mongodb_my_uri" },
        "collection": "sales",
        "read": true,
        "write": true
      }
    },
    {
      "id": "foo_stores",
      "type": "mongodb_collection",
      "properties": {
        "databaseUri": { "_secret": "mongodb_my_uri" },
        "collection": "stores",
        "read": true,
        "write": true
      }
    }
  ],

  "groups": [
    {
      "id": "sales_managers",
      "properties": {
        "title": "Sales Managers"
      },
      "pages": ["sales_report"],
      "groups": [
        {
          "id": "agents_jhb",
          "pages": ["sales_capture"]
        }
      ]
    }
  ],


  "pages": [
    {
      "id": "sales_capture",
      "properties": {
        "title": "Sales Capture"
      },

      "requests": [
        {
          "id": "stores",
          "type": "mongodb_aggregation",
          "connectionId": "foo_stores",
          "properties": {
            "pipeline": [
              { "$project": {
                "value": "$_id",
                "label": "$store_name"
              } }
            ]
          }
        },
        {
          "id": "sales_save",
          "type": "mongodb_insert",
          "connectionId": "foo_sales",
          "properties": {
            "pipeline": [
              { "$addFields": {
                  "capture_date" : { "_date": "now" },
                  "agent": { "_user": "id" },
                  "agent_name": { "_user": "fullName" },
                  "manager": { "_user": "manager" }
              } }
            ]
          }
        }
      ],

      "blocks": [
        {
          "name": "store",
          "type": "select_input",
          "properties": {
            "label": "Store",
            "options": { "_request": "stores" }
          }
        },
        {
          "name": "product_code",
          "type": "text_input",
          "properties": {
            "label": "Product Code",
            "rules": [
              {
                "rule": "regex",
                "test": "/^ABC-\\d{9}$/",
                "message": "Not a valid product code."
              }
            ]
          }
        },
        {
          "name": "sales",
          "type": "number_input",
          "properties": {
            "label": "Number sold",
            "minimum": 1,
            "precision": 0
          }
        },
        {
          "name": "sales_comment",
          "type": "text_input",
          "visible": {"_mql_test": { "sales": { "$gte": 5 } }},
          "properties": {
            "label": "Why did you make the sale?",
            "rows": 4
          }
        },
        {
          "name": "save",
          "type": "button_input",
          "properties": {
            "label": "Save",
            "onClick": {"_request": "sales_save"}
          }
        }
      ]
    },

    {
      "_ref": "/sales/manager_report.json"
    }
    
  ]
}