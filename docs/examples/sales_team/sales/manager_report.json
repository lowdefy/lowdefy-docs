{
  "id": "sales_report",
  "properties": { "title": "Foo Sales" },

  "requests": [
    {
      "id": "sales_by_week",
      "type": "mongodb_aggregation",
      "connectionId": "foo_sales",
      "properties": {
        "pipeline": { "_ref": "/sales/data/ag_sales_by_week.json" }
      }
    }, 
    {
      "id": "sales_my_agents",
      "type": "mongodb_query",
      "connectionId": "foo_sales",
      "properties": {
        "query": { "$and": [ 
          { "manager": {"_user": "id" }}, 
          { "$expr": { "$gte": [
            "$capture_date", 
            {
              "$dateFromParts": {
                "year": { "$year": { "_date": "now" } },
                "month": {"$month": { "_date": "now" } }
              }
            }
          ]}}
        ]}
      }
    }
  ],


  "blocks": [
    {
      "name": "group_by",
      "type": "select_input",
      "properties": {
        "label": "Store",
        "options": [
          {
            "label": "Week",
            "value": "$week"
          },
          {
            "label": "Month",
            "value": "$month"
          }
        ]
      }
    },
    {
      "name": "sales_by_week",
      "type": "amcharts_xy",
      "properties": {
        "data": { "_request": "sales_by_week" },
        "series": [
          {
            "type": "lineSeries",
            "valueY": "sales",
            "dateX": "week"
          }
        ]
      }
    }, 
    {
      "name": "sales_by_week",
      "type": "aggrid_table",
      "properties": {
        "data": { "_request": "sales_my_agents" },
        "columnDefs": [
          { "headerName": "Date", "field": "capture_date" },
          { "headerName": "Agent", "field": "agent" },
          { "headerName": "Sales", "field": "sales" }
        ]
      }
    }
  ]
}